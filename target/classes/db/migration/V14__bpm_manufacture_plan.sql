CREATE SEQUENCE BPM_MANUFACTURE_LINE_SEQUENCE;
CREATE SEQUENCE BPM_MANUFACTURE_PLAN_ITEM_SEQUENCE;
CREATE SEQUENCE BPM_MANUFACTURE_PLAN_SEQUENCE;

create table BPM_MANUFACTURE_LINE (
    ID integer NOT NULL,
    NAME TEXT NOT NULL,
    primary key (ID)
);

create table BPM_MANUFACTURE_PLAN (
    ID integer NOT NULL,
    MONTH timestamp NOT NULL,
    primary key (ID)
);

create table BPM_MANUFACTURE_PLAN_ITEM (
    ID integer NOT NULL,
    BPM_MANUFACTURE_PLAN_ID integer NOT NULL,
    BPM_MANUFACTURE_LINE_ID integer NOT NULL,
    BPM_ARTICLE_ID integer NOT NULL,
    QUANTITY integer NOT NULL DEFAULT 0,
    primary key (ID)
);

create index BPM_MANUFACTURE_PLAN_ITEM_BPM_MANUFACTURE_PLAN_IDX on BPM_MANUFACTURE_PLAN_ITEM(BPM_MANUFACTURE_PLAN_ID);
create index BPM_MANUFACTURE_PLAN_ITEM_BPM_MANUFACTURE_LINE_IDX on BPM_MANUFACTURE_PLAN_ITEM(BPM_MANUFACTURE_LINE_ID);
create index BPM_MANUFACTURE_PLAN_ITEM_BPM_ARTICLE_IDX on BPM_MANUFACTURE_PLAN_ITEM(BPM_ARTICLE_ID);

alter table BPM_MANUFACTURE_PLAN_ITEM
    add constraint BPM_MANUFACTURE_PLAN_ITEM_BPM_MANUFACTURE_PLAN_CONST
    foreign key (BPM_MANUFACTURE_PLAN_ID)
    references BPM_MANUFACTURE_PLAN(ID);
    
alter table BPM_MANUFACTURE_PLAN_ITEM
    add constraint BPM_MANUFACTURE_PLAN_ITEM_BPM_MANUFACTURE_LINE_CONST
    foreign key (BPM_MANUFACTURE_LINE_ID)
    references BPM_MANUFACTURE_LINE(ID);
    
alter table BPM_MANUFACTURE_PLAN_ITEM
    add constraint BPM_MANUFACTURE_PLAN_ITEM_BPM_ARTICLE_CONST
    foreign key (BPM_ARTICLE_ID)
    references BPM_ARTICLE(ID);
    
    
/* Чтобы откатить миграцию
drop SEQUENCE BPM_MANUFACTURE_PLAN_ITEM_SEQUENCE;
drop SEQUENCE BPM_MANUFACTURE_PLAN_SEQUENCE;
drop SEQUENCE BPM_MANUFACTURE_LINE_SEQUENCE;


drop table BPM_MANUFACTURE_PLAN_ITEM;
drop table BPM_MANUFACTURE_PLAN;
drop table BPM_MANUFACTURE_LINE;
*/